JavaScript 的执行上下文（Execution Context）是解释器在运行 JavaScript 代码时创建的一种环境，以决定代码中的变量和函数如何被解析和执行。执行上下文是 JavaScript 执行的核心概念，理解它对于掌握 JavaScript 的工作原理至关重要。以下是执行上下文的一些关键方面：

### 1. 执行上下文的类型

JavaScript 中有三种主要的执行上下文类型：

- **全局执行上下文**（Global Execution Context）: 这是 JavaScript 代码执行的起点。当 JavaScript 文件被加载时，首先创建全局上下文。全局上下文是包含在下面的全局对象的顶层：
  - 在浏览器中，这个全局对象是 `window`。
  - 在 Node.js 中，基本全局对象是 `global`。

- **函数执行上下文**（Function Execution Context）: 每当一个函数被调用时，都会创建一个新的执行上下文。每个函数都有自己的执行上下文，用于管理其局部变量和函数参数。函数上下文还包含对外部作用域的引用，这意味着它可以访问外部环境中的变量。

- ** eval 执行上下文**: 当 JavaScript 代码在 `eval` 函数中执行时，会创建一个新的执行上下文。通常不推荐使用 `eval`，因为它会带来安全性和性能问题。

### 2. 执行上下文的组成

每个执行上下文 都包含三个主要部分：

- **变量环境（Variable Environment）**: 这是一个用于保存变量的环境。在函数执行上下文中，这包括函数的参数以及在函数内部声明的变量。在全局上下文中，这包含全局变量。

- **词法环境（Lexical Environment）**: 记录了变量和函数的绑定关系。每当创建一个新的执行上下文时，都会创建一个新的词法环境。词法环境维护着对自己创建时的作用域及其上级 lexical environment 的引用。

- **`this` 值**: 每个执行上下文都有一个 `this` 值，具体取决于函数的调用方式。在全局上下文中，`this` 指向全局对象；在函数上下文中，`this` 的值取决于函数的调用方式。

### 3. 执行上下文的生命周期

执行上下文的生命周期可以分为以下几个阶段：

1. **创建阶段**:
   - 创建变量环境和词法环境。
   - 变量提升（Hoisting）：在这个阶段，函数声明和变量声明会被提升到作用域的顶部，但只会被初始化为 `undefined`，实际的值会在后面的代码运行时赋值。
   - 记录 `this` 的值。

2. **执行阶段**:
   - 代码逐行执行，访问和更新变量、执行函数调用和其他操作。

3. **销毁阶段**:
   - 当执行上下文执行完成时，会被销毁。此时的变量也会随着执行上下文的结束而被清理。

### 4. 嵌套执行上下文

JavaScript 允许函数嵌套，因此可以产生多个嵌套的执行上下文。当一个函数在另一个函数内部被调用时，会创建一个新的执行上下文。这种情况下，新上下文仍然可以访问外部函数的变量，这就是闭包（Closure）概念的基础。

### 5. 作用域链

每个执行上下文都有一个作用域链，它连接了当前执行上下文的变量环境和其外部环境。这样，JavaScript 可以在执行代码时查找变量。这个查找过程会沿着作用域链向上查找，直到找到变量或达到全局上下文。

### 总结

执行上下文是 JavaScript 执行代码的关键概念，它为每次函数调用或全局执行创建一个独立的环境。理解执行上下文及其组件有助于更好地掌握 JavaScript 的作用域、变量提升、闭包等重要概念。

-----------------



执行上下文是 JavaScript 的一个重要概念，它是代码运行时的环境。每当 JavaScript 执行一段代码时，都会创建一个执行上下文。执行上下文的组成部分主要包括以下几点：

1. **变量环境（Variable Environment）**：
   - 存储变量和函数声明的作用域。每当一个新的执行上下文被创建时，都会创建一个新的变量环境，用于存放该上下文中的变量和函数。
2. **词法环境（Lexical Environment）**：
   - 与变量环境类似，但它还包含了一个指向外部环境的引用，形成了作用域链。词法环境主要用于管理作用域嵌套关系。
3. **this 绑定（This Binding）**：
   - 执行上下文还包含对 `this` 关键字的绑定。`this` 的值取决于函数的调用方式，可能指向不同的对象。
4. **上下文的类型（Context Type）**：
   - 执行上下文可以分为全局上下文、函数上下文、块级上下文等。
     - **全局上下文**：程序开始运行时创建的上下文，只有一个，`this` 绑定到全局对象（在浏览器中为 `window`）。
     - **函数上下文**：每当调用一个函数时，都会创建一个新的函数执行上下文。
     - **块级上下文**：例如，`let`、`const` 和 `class` 等引入的块级作用域。

这些组成部分一起决定了代码在执行时的行为，包括变量的访问、作用域的解析以及 `this` 的值等。在 JavaScript 中，理解这些概念是掌握作用域和闭包等高级特性的基础。